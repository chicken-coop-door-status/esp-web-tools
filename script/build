# Stop on errors
set -e

cd "$(dirname "$0")/.."
node - <<'NODE'
const fs = require("fs");
const { version } = require("./package.json");
fs.writeFileSync("src/version.ts", `export const version = ${JSON.stringify(version)};`);
NODE

rm -rf dist
NODE_ENV=production npm exec -- tsc
NODE_ENV=production npm exec -- rollup -c
